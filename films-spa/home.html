<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="referrer" content="never">

    <link rel="stylesheet" href="./css/base.css">
    <script src="./js/common.js"></script>
    <script src="./js/vue.js"></script>
    <script src="./js/jquery-1.8.0.min.js"></script>

    <link rel="import" href="./components/NavBar.html">
    <!-- <link rel="import" href="./components/FilmeItem.html"> -->
    <link rel="import" href="./components/Filmelist.html">

    <title>电影首页</title>
    <script>
        Vue.component("NavBar",NavBar);
    </script>
    <script>
        window.onload = function(){
            new Vue({
                el:".app",
                components:{
                    // NarBar:NarBar
                    // FilmItem:FilmeItem
                    FilmList
                },
                data:{
                    types:[],
                    // filmList:[]
                },
                methods: {
                    loadTypes(){
                        $.ajax({
                            url:"http://127.0.0.1/filmApi/loadTyps.php",
                            dataType:"json",
                            success:(data)=>{
                                // console.log(data);
                                this.types = data.result;
                                for (let i = 0; i < data.result.length; i++) {
                                    
                                    this.loadFilmsById(data.result[i].typeId,i);
                                    
                                }
                            }
                        })
                    },
                    loadFilmsById(typeId,i){
                        $.ajax({
                            url:"http://127.0.0.1/filmApi/loadFilms.php",
                            dataType:"json",
                            data:{
                                typeId:typeId
                            },
                            success:(data)=>{
                                // console.log(data);
                                // this.filmList = data.result;
                                // this.types[i].list = data.result;
                                this.$set(this.types[i],"list",data.result);
                            }
                        })
                    }
                },
                mounted() {
                    this.loadTypes();
                },
            });
        }
    </script>
</head>

<body>
    <!-- 项目容器 start-->
    <div class="app">
        <!-- 头部搜索框 start -->
        <nav-bar></nav-bar>
        <!-- 头部搜索框 end -->
        <!-- 首页正文 start -->
        <div class="content-box">
            <div class="home-box">
                <!-- 首页分类列表 start -->
                <div v-for="type in types" :key="type.typeId">
                    <div class="list-name">
                        <span>{{ type.typeName }}</span>
                        <span class="list-more">更多 > </span>
                    </div>
                    <film-list class="list-content" :list="type.list"></film-list>
                    <!-- <div class="list-content"> -->
                        <!-- 电影展示组件 start -->
                        <!-- <film-item v-for="film, index in type.list" :key="film.filmId" :film=" film "></film-item> -->
                        <!-- 电影展示组件 end -->
                    <!-- </div> -->
                </div>
                <!-- 首页分类列表 end -->
            </div>
        </div>
        <!-- 首页正文 end -->
    </div>
    <!-- 项目容器 end-->
</body>

</html>